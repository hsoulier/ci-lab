name: PR
run-name: PR ${{ github.ref_name }}
on:
  pull_request:
    types: [opened, reopened, synchronize, review_requested]

jobs:
  Prepare:
    uses: ./.github/actions/base.yml
  Build:
    needs: Prepare
    uses: ./.github/actions/build.yml
  Deploy:
    needs: Build
    uses: ./.github/actions/test.yml
  Clean:
    runs-on: ubuntu-latest
    needs: Deploy
    steps:
      - name: Clear cache
        uses: actions/github-script@v6
        with:
          script: |
            const script = require('./.github/actions/clean-cache.js')
            script({github, context}, true)
